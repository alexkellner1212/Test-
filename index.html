<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LKW Logistik Dashboard V5.0 (Pro)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --future: #6366f1;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; transition: all 0.3s ease; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* Header Styling */
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        h1 { margin: 0; color: #111827; font-size: 1.8rem; display: flex; align-items: center; gap: 10px; }
        h2 { border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-top: 0; font-size: 1.25rem; font-weight: 600; }

        /* Grid Layout */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 40px; }
        .full-width { grid-column: 1 / -1; }
        
        /* Cards */
        .card { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; }

        /* Formular */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9em; color: #4b5563; }
        input, select { width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; box-sizing: border-box; font-size: 14px; transition: border-color 0.2s; }
        input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        
        /* Buttons */
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; color: white; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
        .btn:hover { filter: brightness(110%); transform: translateY(-1px); }
        .btn:active { transform: translateY(0); }
        
        .btn-primary { background-color: var(--primary); width: 100%; font-size: 16px; padding: 10px; }
        .btn-success { background-color: var(--success); }
        .btn-danger { background-color: var(--danger); }
        .btn-warning { background-color: var(--warning); color: #fff; }
        .btn-future { background-color: var(--future); }
        .btn-small { padding: 4px 10px; font-size: 12px; }

        /* Toolbar Buttons */
        .toolbar { display: flex; gap: 10px; }

        /* Tabellen */
        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 10px; }
        th { background-color: #f9fafb; font-weight: 600; text-align: left; padding: 12px; border-bottom: 2px solid #e5e7eb; color: #374151; position: sticky; top: 0; }
        td { padding: 12px; border-bottom: 1px solid #f3f4f6; vertical-align: middle; color: #4b5563; }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background-color: #f9fafb; }
        
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .in { background-color: #d1fae5; color: #047857; }
        .out { background-color: #fef3c7; color: #b45309; }
        
        /* Status Zeilen */
        .row-overdue { background-color: #fef2f2 !important; }
        .row-overdue td:first-child { border-left: 4px solid var(--danger); }
        .row-planned td:first-child { border-left: 4px solid var(--primary); }
        .row-future td:first-child { border-left: 4px solid var(--future); }

        /* Statistik Boxen */
        .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        .stat-box { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border-top: 4px solid var(--primary); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .stat-label { font-size: 0.9em; color: #6b7280; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-number { font-size: 2.5rem; font-weight: 800; color: #111827; margin-top: 5px; line-height: 1; }

        /* Chart Container */
        .chart-container { position: relative; height: 200px; width: 100%; }

        /* Animationen */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.3s ease-out; }

        @media (max-width: 900px) { .dashboard-grid, .stats-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    
    <div class="header-row">
        <h1>üöõ Logistik Leitstand <span style="font-size: 0.5em; background: #e0e7ff; color: #3730a3; padding: 2px 8px; border-radius: 4px; margin-left: 10px;">V5.0</span></h1>
        <div class="toolbar">
            <button onclick="exportCSV()" class="btn btn-success btn-small">üìä Excel/CSV Export</button>
            <button onclick="clearAllData()" class="btn btn-danger btn-small">üóëÔ∏è Reset</button>
        </div>
    </div>

    <div class="stats-row">
        <div class="stat-box" style="border-top-color: #2563eb;">
            <span class="stat-label">Fr√ºhschicht (06-14)</span>
            <span class="stat-number" id="stat-early">0</span>
        </div>
        <div class="stat-box" style="border-top-color: #7c3aed;">
            <span class="stat-label">Sp√§tschicht (14-22)</span>
            <span class="stat-number" id="stat-late">0</span>
        </div>
        <div class="stat-box" style="border-top-color: #db2777;">
            <span class="stat-label">Sto√üzeit (Peak)</span>
            <span class="stat-number" id="stat-peak">-</span>
        </div>
    </div>

    <div class="card full-width">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>üìà Auslastung & Frequenz (Heute)</h2>
            <small style="color:#999">Aktualisiert sich automatisch</small>
        </div>
        <div class="chart-container">
            <canvas id="frequencyChart"></canvas>
        </div>
    </div>

    <div class="dashboard-grid">
        
        <div class="card">
            <h2>‚ö° Sofort-Erfassung (Ist-Zustand)</h2>
            <form id="logForm">
                <div class="form-group">
                    <label>Uhrzeit (Ankunft)</label>
                    <input type="time" id="logTime" required>
                </div>
                <div class="form-group">
                    <label>Spedition</label>
                    <input type="text" id="logSpedition" list="companyList" placeholder="z.B. DHL" required autocomplete="off">
                    <datalist id="companyList"></datalist>
                </div>
                <div class="form-group">
                    <label>Kennzeichen</label>
                    <input type="text" id="logPlate" placeholder="K-AB 123" style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label>Ware / Ladungstr√§ger</label>
                    <input type="text" id="logWare" placeholder="Stahl, Paletten, Gitterboxen..." required>
                </div>
                <div class="form-group">
                    <label>Vorgang</label>
                    <select id="logType">
                        <option value="Anlieferung">Anlieferung (Wareneingang)</option>
                        <option value="Abholung">Abholung (Versand)</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">üíæ LKW Erfassen</button>
            </form>
        </div>

        <div class="card">
            <h2>‚úÖ Abgefertigte / Anwesende LKW (Heute)</h2>
            <div style="overflow-x:auto;">
                <table id="logTable">
                    <thead>
                        <tr>
                            <th>Zeit</th>
                            <th>Typ</th>
                            <th>Spedition</th>
                            <th>Kennz.</th>
                            <th>Ware</th>
                            <th style="text-align:right">Opt</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="emptyLogMsg" style="text-align:center; padding:20px; color:#9ca3af; font-style:italic;">Noch keine Eintr√§ge heute.</div>
        </div>
    </div>

    <hr style="border:0; border-top: 1px dashed #cbd5e1; margin: 40px 0;">

    <h2 style="margin-bottom:20px; display:flex; align-items:center; gap:10px;">
        <span style="background:#e0e7ff; padding:5px; border-radius:50%;">üìÖ</span> Planung & Disposition
    </h2>

    <div class="dashboard-grid">
        <div class="card">
            <h3 style="margin-top:0">Neuen LKW avisieren</h3>
            <form id="planForm">
                <div class="form-group">
                    <label>Geplantes Datum</label>
                    <input type="date" id="planDate" required>
                </div>
                <div class="form-group">
                    <label>Geplante Uhrzeit</label>
                    <input type="time" id="planTime" required>
                </div>
                <div class="form-group">
                    <label>Spedition</label>
                    <input type="text" id="planSpedition" list="companyList" required autocomplete="off">
                </div>
                <div class="form-group">
                    <label>Kennzeichen (Optional)</label>
                    <input type="text" id="planPlate" style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label>Ware</label>
                    <input type="text" id="planWare" required>
                </div>
                <div class="form-group">
                    <label>Vorgang</label>
                    <select id="planType">
                        <option value="Anlieferung">Anlieferung</option>
                        <option value="Abholung">Abholung</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success" style="width:100%">üìÖ Zur Planung hinzuf√ºgen</button>
            </form>
        </div>

        <div style="display: flex; flex-direction: column; gap: 20px;">
            
            <div class="card" style="border-left: 5px solid var(--primary);">
                <h3 style="margin-top:0; color: var(--primary);">üî• Offene Avisierungen Heute (<span id="dateDisplayToday"></span>)</h3>
                <div style="overflow-x:auto;">
                    <table id="planTableToday">
                        <thead>
                            <tr>
                                <th>Plan</th>
                                <th>Status</th>
                                <th>Spedition</th>
                                <th>Kennz.</th>
                                <th>Ware</th>
                                <th style="text-align:right">Aktion</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <p id="noTodayMsg" style="text-align:center; color:#9ca3af; padding: 20px;">Keine weiteren LKW f√ºr heute geplant.</p>
            </div>

            <div class="card" style="background-color: #f8fafc; border: 1px solid #e2e8f0; border-left: 5px solid var(--future);">
                <h3 style="margin-top:0; color: var(--future);">üîú Zuk√ºnftige Anlieferungen</h3>
                <div style="overflow-x:auto;">
                    <table id="planTableFuture">
                        <thead>
                            <tr>
                                <th>Datum</th>
                                <th>Zeit</th>
                                <th>Spedition</th>
                                <th>Ware</th>
                                <th style="text-align:right">Aktion</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                 <p id="noFutureMsg" style="text-align:center; color:#9ca3af; padding: 20px;">Keine zuk√ºnftigen Planungen.</p>
            </div>

        </div>
    </div>
</div>

<script>
    // --- STATE MANAGEMENT ---
    let lkwLog = JSON.parse(localStorage.getItem('lkwLog')) || [];
    let lkwPlan = JSON.parse(localStorage.getItem('lkwPlan')) || [];
    let myChart = null;

    // E-Mail f√ºr Benachrichtigungen hier anpassen
    const EMAIL_RECIPIENT = "alexander.kellner@haertecenter.de";

    // --- INITIALISIERUNG ---
    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('planDate').value = today;
        document.getElementById('dateDisplayToday').textContent = new Date().toLocaleDateString('de-DE');

        setNow('logTime');
        
        initChart();

        // Datumsfix f√ºr alte Daten
        lkwPlan = lkwPlan.map(entry => {
            if(!entry.date) entry.date = today; 
            return entry;
        });

        renderAll();
        
        // Auto-Refresh jede Minute f√ºr "√úberf√§llig"-Status
        setInterval(renderAll, 60000); 
    });

    // --- CHART LOGIK (Verbessert) ---
    function initChart() {
        const ctx = document.getElementById('frequencyChart').getContext('2d');
        
        // Gradient erstellen f√ºr coolen Look
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(37, 99, 235, 0.5)');
        gradient.addColorStop(1, 'rgba(37, 99, 235, 0.0)');

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Anzahl LKW',
                    data: [],
                    borderColor: '#2563eb',
                    backgroundColor: gradient,
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#2563eb',
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1, color: '#6b7280' },
                        grid: { color: '#e5e7eb' }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#6b7280' }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#1f2937',
                        padding: 10,
                        cornerRadius: 4
                    }
                }
            }
        });
    }

    function updateChart() {
        if(!myChart) return;

        const hours = [];
        const data = [];
        const todayStr = new Date().toISOString().split('T')[0];
        
        // Zeige Stunden von 06 bis 20 Uhr (Kernzeit)
        for(let i=6; i<=20; i++) {
            hours.push(i.toString().padStart(2, '0') + ' Uhr');
        }

        const counts = {};
        lkwLog.forEach(entry => {
            if(entry.date === todayStr) {
                const h = parseInt(entry.time.split(':')[0]);
                counts[h] = (counts[h] || 0) + 1;
            }
        });

        for(let i=6; i<=20; i++) {
            data.push(counts[i] || 0);
        }

        myChart.data.labels = hours;
        myChart.data.datasets[0].data = data;
        myChart.update();
    }

    // --- AUTOCOMPLETE LOGIK ---
    function updateCompanyList() {
        const datalist = document.getElementById('companyList');
        datalist.innerHTML = '';
        
        // Sammle alle eindeutigen Speditionsnamen aus Log und Plan
        const companies = new Set();
        lkwLog.forEach(i => companies.add(i.spedition));
        lkwPlan.forEach(i => companies.add(i.spedition));

        // Sortieren und hinzuf√ºgen
        Array.from(companies).sort().forEach(comp => {
            const opt = document.createElement('option');
            opt.value = comp;
            datalist.appendChild(opt);
        });
    }

    // --- FORMULARE & DATA HANDLING ---

    document.getElementById('logForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const entry = getFormData('log');
        entry.date = new Date().toISOString().split('T')[0];
        entry.shift = calculateShift(entry.time);
        
        lkwLog.push(entry);
        saveAndRender();
        this.reset();
        setNow('logTime');
        
        // Feedback Animation
        const btn = this.querySelector('button[type="submit"]');
        const origText = btn.innerHTML;
        btn.innerHTML = "‚úÖ Gespeichert";
        setTimeout(() => btn.innerHTML = origText, 1500);
    });

    document.getElementById('planForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const data = getFormData('plan');
        const dateVal = document.getElementById('planDate').value;
        
        lkwPlan.push({
            ...data,
            date: dateVal,
            notified: false
        });
        
        saveAndRender();
        this.reset();
        document.getElementById('planDate').value = new Date().toISOString().split('T')[0];
    });

    function getFormData(prefix) {
        return {
            id: Date.now(),
            time: document.getElementById(prefix + 'Time').value,
            spedition: document.getElementById(prefix + 'Spedition').value.trim(),
            plate: (document.getElementById(prefix + 'Plate').value || '-').toUpperCase().trim(),
            ware: document.getElementById(prefix + 'Ware').value.trim(),
            type: document.getElementById(prefix + 'Type').value
        };
    }

    function calculateShift(timeStr) {
        const hour = parseInt(timeStr.split(':')[0]);
        if (hour >= 6 && hour < 14) return "Fr√ºh";
        if (hour >= 14 && hour < 22) return "Sp√§t";
        return "Nacht";
    }

    // Vom Plan ins Log verschieben
    function checkIn(id) {
        const index = lkwPlan.findIndex(x => x.id === id);
        if (index > -1) {
            const item = lkwPlan[index];
            const now = new Date();
            // Wir nehmen die aktuelle Zeit als Ankunftszeit, nicht die geplante
            const timeStr = now.toTimeString().substring(0,5);
            const dateStr = now.toISOString().split('T')[0];
            
            const logEntry = {
                ...item, id: Date.now(), date: dateStr, time: timeStr, shift: calculateShift(timeStr)
            };
            lkwLog.push(logEntry);
            lkwPlan.splice(index, 1);
            saveAndRender();
        }
    }

    function deleteLog(id) {
        if(confirm("Eintrag wirklich l√∂schen?")) {
            lkwLog = lkwLog.filter(x => x.id !== id);
            saveAndRender();
        }
    }
    
    function deletePlan(id) {
        if(confirm("Planung l√∂schen?")) {
            lkwPlan = lkwPlan.filter(x => x.id !== id);
            saveAndRender();
        }
    }

    function sendLateMail(id) {
        const item = lkwPlan.find(x => x.id === id);
        if(!item) return;
        const subject = `VERZUG: LKW ${item.spedition} √ºberf√§llig`;
        const body = `Hallo Logistik-Team,\n\nder geplante LKW ist √ºberf√§llig.\n\nPlan-Datum: ${item.date}\nPlan-Zeit: ${item.time}\nSpedition: ${item.spedition}\nWare: ${item.ware}\nKennzeichen: ${item.plate}\n\nBitte pr√ºfen.`;
        window.location.href = `mailto:${EMAIL_RECIPIENT}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }

    // --- CSV EXPORT (NEU) ---
    function exportCSV() {
        if(lkwLog.length === 0) {
            alert("Keine Daten zum Exportieren vorhanden.");
            return;
        }

        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Datum;Uhrzeit;Schicht;Typ;Spedition;Kennzeichen;Ware\n"; // Header

        lkwLog.forEach(row => {
            // Daten bereinigen f√ºr CSV (Semikolon vermeiden in Textfeldern)
            const clean = (txt) => String(txt).replace(/;/g, ",");
            
            const rowStr = [
                row.date,
                row.time,
                row.shift,
                row.type,
                clean(row.spedition),
                clean(row.plate),
                clean(row.ware)
            ].join(";");
            csvContent += rowStr + "\n";
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        const dateStr = new Date().toISOString().split('T')[0];
        link.setAttribute("download", `LKW_Logistik_Export_${dateStr}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function saveAndRender() {
        localStorage.setItem('lkwLog', JSON.stringify(lkwLog));
        localStorage.setItem('lkwPlan', JSON.stringify(lkwPlan));
        renderAll();
    }

    function renderAll() {
        renderLogTable();
        renderPlanTables();
        calculateStats();
        updateChart();
        updateCompanyList(); // Datalist aktualisieren
    }

    // --- RENDERING ---

    function renderLogTable() {
        const tbody = document.querySelector('#logTable tbody');
        const emptyMsg = document.getElementById('emptyLogMsg');
        tbody.innerHTML = '';
        const todayStr = new Date().toISOString().split('T')[0];

        const sorted = [...lkwLog].sort((a,b) => {
            // Sortiere erst nach Datum (neueste zuerst), dann nach Zeit
            if(b.date !== a.date) return b.date.localeCompare(a.date);
            return b.time.localeCompare(a.time); // Neueste Zeit oben
        });

        let visibleCount = 0;

        sorted.forEach(entry => {
            if(entry.date !== todayStr) return; 
            visibleCount++;

            const badgeClass = entry.type === 'Anlieferung' ? 'in' : 'out';
            const tr = document.createElement('tr');
            tr.className = 'fade-in';
            tr.innerHTML = `
                <td><strong>${entry.time}</strong></td>
                <td><span class="badge ${badgeClass}">${entry.type}</span></td>
                <td>${entry.spedition}</td>
                <td><span style="font-family:monospace; background:#eee; padding:2px 4px; border-radius:3px;">${entry.plate}</span></td>
                <td>${entry.ware}</td>
                <td style="text-align:right"><button onclick="deleteLog(${entry.id})" class="btn btn-danger btn-small" title="L√∂schen">üóëÔ∏è</button></td>
            `;
            tbody.appendChild(tr);
        });

        emptyMsg.style.display = visibleCount === 0 ? 'block' : 'none';
    }

    function renderPlanTables() {
        const tbodyToday = document.querySelector('#planTableToday tbody');
        const tbodyFuture = document.querySelector('#planTableFuture tbody');
        tbodyToday.innerHTML = '';
        tbodyFuture.innerHTML = '';

        const todayStr = new Date().toISOString().split('T')[0];
        const now = new Date();
        const currentMinutes = now.getHours() * 60 + now.getMinutes();

        // Sortierung: N√§chstes Event oben
        const sorted = [...lkwPlan].sort((a,b) => {
            if(a.date !== b.date) return a.date.localeCompare(b.date);
            return a.time.localeCompare(b.time);
        });

        let countToday = 0;
        let countFuture = 0;

        sorted.forEach(entry => {
            if (entry.date === todayStr) {
                countToday++;
                const [h, m] = entry.time.split(':').map(Number);
                const planMinutes = h * 60 + m;
                // Toleranz von 15 Minuten bevor "√úberf√§llig" angezeigt wird
                const isLate = currentMinutes > (planMinutes + 15);
                
                const tr = document.createElement('tr');
                tr.className = isLate ? 'row-overdue fade-in' : 'row-planned fade-in';

                let statusHtml = isLate 
                    ? `<span style="color:#ef4444; font-weight:bold; display:flex; align-items:center; gap:4px;">‚ö†Ô∏è √úberf√§llig (+${currentMinutes - planMinutes}m)</span>` 
                    : `<span style="color:#6b7280;">üïì Geplant</span>`;
                
                let actionHtml = isLate
                    ? `<button onclick="checkIn(${entry.id})" class="btn btn-success btn-small">Ist da</button> <button onclick="sendLateMail(${entry.id})" class="btn btn-warning btn-small" title="Email an Logistik">‚úâÔ∏è</button>`
                    : `<button onclick="checkIn(${entry.id})" class="btn btn-success btn-small">‚úÖ Ist da</button> <button onclick="deletePlan(${entry.id})" class="btn btn-danger btn-small" title="Stornieren">üóëÔ∏è</button>`;

                tr.innerHTML = `
                    <td><strong>${entry.time}</strong></td>
                    <td>${statusHtml}</td>
                    <td>${entry.spedition}</td>
                    <td>${entry.plate}</td>
                    <td>${entry.ware}</td>
                    <td style="text-align:right">${actionHtml}</td>`;
                tbodyToday.appendChild(tr);

            } else if (entry.date > todayStr) {
                countFuture++;
                const tr = document.createElement('tr');
                tr.className = 'row-future fade-in';
                const d = new Date(entry.date);
                tr.innerHTML = `
                    <td><strong>${d.toLocaleDateString('de-DE')}</strong></td>
                    <td>${entry.time}</td>
                    <td>${entry.spedition}</td>
                    <td>${entry.ware}</td>
                    <td style="text-align:right"><button onclick="deletePlan(${entry.id})" class="btn btn-danger btn-small">üóëÔ∏è</button></td>`;
                tbodyFuture.appendChild(tr);
            }
        });

        document.getElementById('noTodayMsg').style.display = countToday === 0 ? 'block' : 'none';
        document.getElementById('noFutureMsg').style.display = countFuture === 0 ? 'block' : 'none';
    }

    function calculateStats() {
        let early = 0, late = 0;
        let hours = {};
        const todayStr = new Date().toISOString().split('T')[0];

        lkwLog.forEach(e => {
            if(e.date === todayStr) {
                if(e.shift === 'Fr√ºh') early++;
                if(e.shift === 'Sp√§t') late++;
                const h = parseInt(e.time.split(':')[0]);
                hours[h] = (hours[h] || 0) + 1;
            }
        });

        let max = 0, peak = '-';
        // Finde Stunde mit den meisten LKWs
        for(let [h, c] of Object.entries(hours)) {
            if(c > max) { max = c; peak = `${h}:00 - ${parseInt(h)+1}:00`; }
        }

        // Animierte Nummern (einfach)
        document.getElementById('stat-early').textContent = early;
        document.getElementById('stat-late').textContent = late;
        document.getElementById('stat-peak').textContent = peak;
    }

    function setNow(id) {
        const now = new Date();
        const el = document.getElementById(id);
        if(el) el.value = now.toTimeString().substring(0,5);
    }

    function clearAllData() {
        if(confirm("ACHTUNG: Alle Daten werden unwiderruflich gel√∂scht! Fortfahren?")) {
            lkwLog = []; lkwPlan = []; saveAndRender();
        }
    }
</script>

</body>
</html>
